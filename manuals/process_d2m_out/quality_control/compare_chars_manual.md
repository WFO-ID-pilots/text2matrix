# compare_chars.py user manual

This document is a manual explaining the usage of `compare_chars.py`, which compares the output generated by a `desc2matrix` script against the summarised characteristic values from an SDD-formated species key generated by `process_xper/sdd2json.py`.

## Input

The desc2matrix.py output file is expected to have the following structure:

<pre>
{
    (...),
    'data': [
        {
            'coreid': WFO coreid,
            'status': 'success' | '...',
            'original_description': Original plant description,
            'char_json': [
                {
                    'characteristic': Name of characteristic,
                    'value': Corresponding value
                }, (...)
            ] if status == 'success' else None,
            'failed_str': String that failed to parse if status != 'success' else None
        }
    ]
}
</pre>

The sdd2json.py output is expected to have the following structure:

<pre>
{
    Species binomial: [
        {
            'characteristic': Name of characteristic,
            'value': Corresponding value
        }, (...)
    ]
}
</pre>

This script also takes in a `taxa` tsv file generated by `dwca2csv.py`. This is needed to associate the spcies in the `desc2matrix` output, which is given as WFO core ids, with their scientific names.

## Arguments

| Argument | Description | Required? | Default value |
| --- | --- | --- | --- |
| `charjson` | `desc2matrix` output file | Yes | |
| `originalchars` | `sdd2json` output file | Yes | |
| `taxafile` | `taxa` tsv generated by `dwca2csv.py` | Yes | |
| `outfile` | File to write the tsv output to | Yes | |
| `--silent` | If provided, silence progress logs | No | `False` |

## Output

The output is a tsv file with the following columns, in order:

| Column | Type | Description |
| --- | --- | --- |
| `coreid` | `str` | WFO taxon ID for the species |
| `status` | `str` | Status code for the species returned by `desc2matrix` script |
| `nchars_d2m` | `int` | Number of characteristics in a _successfully parsed_ `desc2matrix` output; `NA` if run filed to parse |
| `nchars_key` | `int` | Number of characteristics in the corresponding structured characteristic description in the key |
| `nchars_common` | `int` | Number of characteristics shared between the two |
| `nwords_d2m_only` | `int` | Number of non-stop words in the d2m output only
| `nwords_key_only` | `int` | Number of non-stop words in the key description only
| `nwords_common` | `int` | Number of non-stop words that are shared between the d2m output and the structured description in the key
| `words_d2m_only` | `list`, comma-separated | Comma-separated list of non-stop words that are only in the d2m output
| `words_key_only` | `list`, comma-separated | Comma-separated list of non-stop words that are only in the structured key
| `words_common` | `list`, comma-separated | Comma-separated list of non-stop words that the d2m output and the key output share
| `nwords_d2m_only_vals` | `int` | With characteristic values only
| `nwords_key_only_vals` | `int` | With characteristic values only
| `nwords_common_vals` | `int` | Same as nwords_common, but with characteristic values only
| `words_d2m_only_vals` | `list`, comma-separated | With characteristic values only
| `words_key_only_vals` | `list`, comma-separated | With characteristic values only
| `words_common_vals` | `list`, comma-separated | With characteristic values only